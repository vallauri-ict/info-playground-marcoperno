/* OGNI MODULO PUO' CONTENERE QUALUNQUE TIPO DI INFORMAZIONE: funzioni, classi, codice generico, risorse */
var qs = require('querystring');
let session = [];
function login(request, response, url){
    response.writeHead(200, {"Content-Type":"text/plain"});

    let datiPacchetto=[];
    request.on('data', function(dato){
        datiPacchetto+=dato;
    })

    request.on("end", function(){
        var parametri = qs.parse(datiPacchetto);
        if(parametri.nome == "marco" && parametri.password == "password")
            {
                let trovato =false;
                let i=0;
                while(trovato == false && i != session.length)
                {
                    if(session[i].nome == parametri.nome)
                    {
                        trovato=true;
                    }
                    i++;
                    
                }
                if(trovato==false)
                {
                    session.push({"nome":parametri.nome});
                    console.log("Login andato a buon fine");
                    response.write("Login corretto");
                }
                else
                {
                    console.log("Login non andato a buon fine");
                    response.write("Login non corretto");
                }
                
            }
            else
            {
                console.log("Login non andato a buon fine");
                response.write("Login non corretto");
            }
        response.end();
    });
}

function logout(request, response, url)
{
    response.writeHead(200, {"Content-Type":"text/plain"});

    let datiPacchetto=[];
    request.on('data', function(dato){
        datiPacchetto+=dato;
    })

    request.on("end", function(){
        var parametri = qs.parse(datiPacchetto);

        let trovato =false;
        let i=0;
        while(trovato == false && i != session.length)
        {
            if(session[i].nome == parametri.nome)
            {
                trovato=true;
            }
            i++;
            
        }
        if(trovato==true)
        {
            //delete session[i-1];
            session.splice(i-1);
            console.log("logut andato a buon fine");
            response.write("logut corretto");
        }
        else
        {
            console.log("logut non andato a buon fine");
            response.write("logut non corretto");
        }
        response.end();
    });


    
}

module.exports.login = login;
module.exports.logout = logout;